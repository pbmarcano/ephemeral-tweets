<% content_for :title, "Upcoming week for #{current_user.username}" %>

<main class="max-w-2xl mx-auto">
  <h1 class="font-extrabold text-3xl text-slate-900 dark:text-slate-300 sm:text-4xl text-center">Upcoming week</h1>
  <div class="mb-10 flex justify-center my-4 text-xl text-slate-500 dark:text-slate-400">
    <%= form_with(
      model: current_user.setting, 
      url: upcoming_setting_path,
      data: {
        controller: "autosubmit",
        autosubmit_target: "form"
      }) do |form| %>

      <div class="flex items-center space-x-2">
        <%= form.check_box :upcoming_notification,
          class: "h-4 w-4 rounded text-sky-500 dark:bg-slate-700 dark:border-none focus:outline-none focus:ring-sky-700 focus:border-sky-700",
          data: { action: "autosubmit#submit" } %>
        <%= form.label :upcoming_notification, "Email me a weekly review every Sunday" %>
      </div>

      <div class="text-center mt-4" data-autosubmit-target="submit">
        <%= form.submit "Update Settings", class: "px-8 py-4 rounded-full bg-white border border-slate-200 shadow-md" %>
      </div>
    <% end %>
  </div>

  <% if @upcoming_review.tweets_this_week.empty? %>
    <div class="flex flex-col items-center">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="h-64 w-64 fill-slate-600 heroicon-diamond heroicon heroicons-lg">
        <polygon class="heroicon-diamond-shape heroicon-component-fill fill-slate-200 dark:fill-slate-600" fill="#FFFFFF" points="20 17 50 13 80 17 100 37 50 87 0 37"></polygon>
        <path class="heroicon-diamond-sparkle heroicon-component-accent heroicon-component-fill fill-sky-300" fill="#7ACFC0" d="M72 36h1a5 5 0 0 0 5-5v-1a1 1 0 0 1 1-1 1 1 0 0 1 1 1v1a5 5 0 0 0 5 5h1a1 1 0 0 1 1 1 1 1 0 0 1-1 1h-1a5 5 0 0 0-5 5v1a1 1 0 0 1-1 1 1 1 0 0 1-1-1v-1a5 5 0 0 0-5-5h-1a1 1 0 0 1-1-1 1 1 0 0 1 1-1zM25 49a3 3 0 0 0 3-3 1 1 0 0 1 1-1 1 1 0 0 1 1 1 3 3 0 0 0 3 3 1 1 0 0 1 1 1 1 1 0 0 1-1 1 3 3 0 0 0-3 3 1 1 0 0 1-1 1 1 1 0 0 1-1-1 3 3 0 0 0-3-3 1 1 0 0 1-1-1 1 1 0 0 1 1-1z"></path>
        <path class="heroicon-shadows fill-slate-100 opacity-10" fill="#000000" d="M48.62 82.8L3.82 38h16.8l5.85 9.35A2 2 0 0 1 25 48a2 2 0 0 0 0 4 2 2 0 0 1 2 2 2 2 0 0 0 3.94.5l17.68 28.3zm2.76 0L76.88 42a4 4 0 0 1 .12 1v1a2 2 0 0 0 4 0v-1a4 4 0 0 1 4-4h1a2 2 0 0 0 1.73-1h8.44L51.38 82.8zM20 36H3.83L20 19.83V36zm60-16.17L96.17 36h-8.43A2 2 0 0 1 86 35h-1a4 4 0 0 1-4-4v-1a2 2 0 0 0-1-1.73v-8.44z" opacity=".2"></path>
        <path class="heroicon-outline fill-slate-900" fill="#4A4A4A" fill-rule="nonzero" d="M20 17l30-4 30 4 20 20-50 50L0 37l20-20zm28.62 65.8L30.94 54.5A2 2 0 0 1 27 54a2 2 0 0 0-2-2 2 2 0 1 1 0-4 2 2 0 0 0 1.47-.65L20.63 38H3.82l44.79 44.8zm-17.4-29.72L50 83.1l26.4-42.23A4 4 0 0 0 73 39h-1c-.76 0-1.42-.42-1.76-1.04L21.8 38l5.18 8.28L27 46a2 2 0 1 1 4 0c0 1.1.9 2 2 2a2 2 0 1 1 0 4 2 2 0 0 0-1.77 1.08zm20.16 29.71L96.18 38h-8.45A2 2 0 0 1 86 39h-1a4 4 0 0 0-4 4v1a2 2 0 1 1-4 0v-1a4 4 0 0 0-.13-1L51.38 82.8zM21 36h.3l27.1-20.77L21 18.88V36zm29-20.74L22.95 36h47.32A2 2 0 0 1 72 35h1c.74 0 1.43-.2 2.03-.55L50 15.26zm1.6-.03l24.24 18.58A3.99 3.99 0 0 0 77 31v-1a2 2 0 0 1 2-2v-9.12l-27.4-3.65zM20 36V19.83L3.83 36H20zm60-16.17v8.44A2 2 0 0 1 81 30v1a4 4 0 0 0 4 4h1a1.99 1.99 0 0 1 1.74 1h8.43L80 19.83zM72 36a1 1 0 0 0-1 1 1 1 0 0 0 1 1h1a5 5 0 0 1 5 5v1a1 1 0 0 0 1 1 1 1 0 0 0 1-1v-1a5 5 0 0 1 5-5h1a1 1 0 0 0 1-1 1 1 0 0 0-1-1h-1a5 5 0 0 1-5-5v-1a1 1 0 0 0-1-1 1 1 0 0 0-1 1v1a5 5 0 0 1-5 5h-1zM25 49a1 1 0 0 0-1 1 1 1 0 0 0 1 1 3 3 0 0 1 3 3 1 1 0 0 0 1 1 1 1 0 0 0 1-1 3 3 0 0 1 3-3 1 1 0 0 0 1-1 1 1 0 0 0-1-1 3 3 0 0 1-3-3 1 1 0 0 0-1-1 1 1 0 0 0-1 1 3 3 0 0 1-3 3z"></path>
      </svg>
      <h2 class="text-2xl font-bold text-slate-700 dark:text-slate-300">Squeaky clean</h2>
      <p class="text-slate-500">No tweets getting swept this week</p>
      <%= link_to "See tweets that will delete later &rarr;".html_safe, tweets_path, class: "text-sky-500 hover:underline" %>
    </div>
  <% end %>

  <div class="flex flex-col space-y-4">
    <% @upcoming_review.grouped_tweets_this_week.each do |daily_tweets| %>
      <div>
        <div class="text-xl font-bold text-slate-600 dark:text-slate-400 tracking-wide m-2 mt-6">
          <%= deletion_day(daily_tweets.first) %>
        </div>

        <%= render "shared/timeline", tweets: daily_tweets.last %>
      </div>
    <% end %>
  </div>
</main>
